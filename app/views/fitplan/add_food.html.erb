<div class="overall">

<%= render '/layouts/navbar' %>

  <div id="food-listings">
  <i>Search results for <%= @food %>:</i>
  <h1><%= @day %></h1>
  <hr />
    <% for i in 0..@results.length-1 %>
      <div id="food-container-<%= i %>" class="foodContainer">
        <div id="food-title-<%= i %>" class="foodTitle" onclick='getCalories(<%= i %>); return false;'><a href="#" id="food-button"><%= raw @results[i] %></a></div>
        <div id="<%= i %>" class="foodData"></div>
      </div>
      <hr />
    <% end %>
  <div>

</div>

<script type="text/javascript">
$(".foodData").hide();

function displayCalorie(selected_id, reply) {
	var element = document.getElementById(selected_id);
    if (element.hasChildNodes()) {
        $(element).show();
    } else if (reply.calorie != -1) {
		var serving_id = "serving"+selected_id;
		$(element).html("<br><div class='info'>&nbsp;&nbsp;&nbsp;&nbsp;1 serving: "+reply.calorie+
        " calories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serving size: "
		+reply.serving.split("Serving Size")[1]+"</div>"+
		"<div class='input'>Servings: <input id='"+serving_id+"' value='1' style='width:35px;'>"+
		"&nbsp;&nbsp;<button type='button' onclick='addFood("+selected_id+")'>"+
		"Add</button></div>");
        /*$(document.getElementById("food-title-"+selected_id)).css("text-decoration", "underline");*/
		$(element).show();
	}
    for (var i=0;i<30;i++) {
        var previous_selection = document.getElementById(i);
        if (previous_selection.hasChildNodes() && i!=selected_id) {
            $(previous_selection).hide();
        }
    }
	return false;
}

function addFood(selected_id) {
	var servings = document.getElementById("serving"+selected_id).value;
	var day = "<%= @day %>";
	send_json("/profile/get_calorie/add",
		{num: selected_id, num_servings: servings, date: day},
		function(reply) {
			if (reply.result == "SUCCESS") {
				window.location.href = "/profile";
			} else {
				alert(reply.result);
			}
		},
		show_error
	);
	return false;
}

function getCalories(selected_id) {
	send_json("/profile/get_calorie",
		{num: selected_id},
		function(reply) {
			return displayCalorie(selected_id, reply);
		},
		show_error
	);
	return false;
}
</script>
