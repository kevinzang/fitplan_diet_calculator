<center>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <ul class="nav">
          <li><a href="/">Home</a></li>
          <li><a href="/profile_form">Edit Profile</a></li>
          <li><a href="/profile">Profile</a></li>
          <li><a href="/profile/workout">Workout Plan</a></li>
        </ul>
      </div>
    </div>
  </div>
	<h1>Search results for <%= @food %>:</h1>
	<% for i in 0..@results.length-1 %>
	<div onclick="getCalories(<%= i %>)"><%= raw @results[i] %></div>
	<div id="<%= i %>" class="foodData"></div>
	<% end %>
</center>
<script type="text/javascript">
$(".foodData").hide();

function displayCalorie(selected_id, reply) {
	var element = document.getElementById(selected_id);
	if (reply.calorie != -1) {
		var serving_id = "serving"+selected_id;
		$(element).html("<div>"+reply.calorie+" calories</div>"+
		"<div>"+reply.serving+"</div>"+
		"<input id='"+serving_id+"'> servings"+
		"<button type='button' onclick='addFood("+selected_id+")'>"+
		"Add</button>");
		$(element).show();
	}
}

function addFood(selected_id) {
	var servings = document.getElementById("serving"+selected_id).value;
	send_json("/profile/add_food/get_calorie/add",
		{num: selected_id, num_servings: servings},
		function(reply) {
			if (reply.result == "SUCCESS") {
				window.location.href = "/profile";
			} else {
				alert(reply.result);
			}
		},
		show_error
	);
	return false;
}

function getCalories(selected_id) {
	send_json("/profile/add_food/get_calorie",
		{num: selected_id},
		function(reply) {
			return displayCalorie(selected_id, reply);
		},
		show_error
	);
	return false;
}
</script>
